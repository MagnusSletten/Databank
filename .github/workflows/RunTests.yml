name: Run tests
on:
  pull_request:
    branches:
      - main
    paths:
      - 'Scripts/**/*.py'

jobs:
    build-and-test:
        if: github.event.pull_request.head.repo.full_name == github.repository
        runs-on: nrec-large 
        steps:
          - name: Pull latest Docker images
            run: |
              # Pull the latest images for Docker Compose
              sudo docker pull nmrlipids/core
    
          - name: Run Docker tests 
            shell: bash
            run: |
                sudo docker run --rm \
                  -e BRANCH_NAME="${{ github.head_ref }}" \
                  nmrlipids/core \
                  bash -c "git pull && Scripts/WorkflowScripts/DockerRunInstructions/Runtests.sh"
            