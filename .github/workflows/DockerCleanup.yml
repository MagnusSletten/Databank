name: Docker Cleanup

on:
  workflow_call:
    inputs:
      delete_images:
        type: boolean 
        description: "If true it will delete all images"
        required: false
        default: false

jobs:
  clean_docker:
    runs-on: nrec-large
    steps:
      - name: Stop and remove all containers
        run: sudo docker container prune -f

      - name: Remove all unused volumes
        run: sudo docker volume prune -f

      - name: Remove all unused networks
        run: sudo docker network prune -f

      - name: Remove all unused build cache
        run: sudo docker builder prune -f

      - name: Remove unused images
        run: sudo docker image prune -f

      - name: Force delete all images (optional)
        if: ${{ inputs.delete_images == 'true' }}
        run: sudo docker image prune -f